<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React Hello World - CDN</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        #root {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- React CDN -->
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.js"></script>
    
    <!-- Babel Standalone for JSX transformation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.22.5/babel.min.js"></script>

<!-- Your React App -->
<script type="text/babel">
    const data = {
        "type": "data",
        "data": {
            "_pagination_key": "p07535305238268870656",
            "_xact_id": "1000195571892760302",
            "created": "2025-08-06T03:12:46.914Z",
            "id": "7fedaa20-c041-4bdc-943e-28b3904ea1dc",
            "metadata": {},
            "metrics": {
                "end": 1754450069.843,
                "start": 1754449966.914,
                "prompt_tokens": 25922,
                "completion_tokens": 1749,
                "tokens": 27671,
                "estimated_cost": 0.104001
            },
            "origin": null,
            "root_span_id": "851a36c1-b43b-4f8f-8ad0-4133979e4cd2",
            "scores": null,
            "span_attributes": {
                "exec_counter": 0,
                "name": "eval",
                "type": "eval"
            },
            "span_id": "851a36c1-b43b-4f8f-8ad0-4133979e4cd2",
            "tags": [],
            "context": {},
            "expected": "The currentUser value is retrieved using zafClient.get('currentUser')",
            "experiment_id": "e6825aa8-a7f0-4501-8bea-e268e7d94436",
            "input": "Create an app that displays current agent information",
            "is_root": true,
            "output": [
                {
                    "args": {
                        "fileContent": "const { useState } = React;\nimport SomeComponent from './components/someComponent'\nimport './styles/styles.js'; \nconst App = () => {\n    const [count, setCount] = useState(0);\n\n    return (\n        <div>\n            <h1>Hello World from React!</h1>\n            <p>This React app is running from CDN without any build process.</p>\n            <SomeComponent count={count} />\n            <div style={{ marginTop: '20px' }}>\n                <button \n                    onClick={() => setCount(count + 1)}\n                    className=\"click-button\"\n                >\n                    Clicked {count} times\n                </button>\n            </div>\n            <div style={{ marginTop: '20px', color: '#666' }}>\n                <small>React {React.version} loaded from CDN</small>\n            </div>\n        </div>\n    );\n}\n\nexport default App;",
                        "filePath": "index.jsx",
                        "operation": "add"
                    },
                    "toolCallId": "toolu_bdrk_01GecPhV165SBq636UvxTquA",
                    "toolName": "updateCode",
                    "type": "tool-call"
                },
                {
                    "args": {
                        "fileContent": "/* Styles for the React app */\n.click-button {\n    padding: 10px 20px;\n    font-size: 16px;\n    background-color: #61dafb;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    transition: background-color 0.2s;\n}\n\n.click-button:hover {\n    background-color: #21a9c7;\n}\n\n.component-container {\n    padding: 16px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;\n    background-color: #f8f9fa;\n    border-radius: 8px;\n    margin: 10px 0;\n}\n\n.component-title {\n    color: #333;\n    margin: 0 0 8px 0;\n    font-size: 18px;\n}",
                        "filePath": "styles/styles.js",
                        "operation": "add"
                    },
                    "toolCallId": "toolu_bdrk_01GecPhV165SBq636UvxTquA",
                    "toolName": "updateCode",
                    "type": "tool-call"
                },
                {
                    "args": {
                        "fileContent": "function SomeComponent({ count }) {\n    return (\n        <div className=\"component-container\">\n            <h3 className=\"component-title\">Some Component</h3>\n            <p>This is a separate component that receives count: <strong>{count}</strong></p>\n            <p>Component loaded from components/someComponent.jsx</p>\n        </div>\n    );\n}\n\n// Export for use in other files\nwindow.SomeComponent = SomeComponent;",
                        "filePath": "components/someComponent.jsx",
                        "operation": "add"
                    },
                    "toolCallId": "toolu_bdrk_01GecPhV165SBq636UvxTquA",
                    "toolName": "updateCode",
                    "type": "tool-call"
                }
            ]
        }
    };

    // Extract and execute multiple files from the data structure
    const outputFiles = data.data.output;
    
    try {
        console.log("Processing files:", outputFiles.map(f => f.args.filePath));
        
        // 1) Load and apply all CSS/styles files
        const styleFiles = outputFiles.filter(file => 
            file.args.filePath.includes('styles') || 
            file.args.filePath.endsWith('.css') || 
            file.args.filePath.includes('styles.js')
        );
        styleFiles.forEach(styleFile => {
            console.log(`Loading styles from: ${styleFile.args.filePath}`);
            const styleElement = document.createElement('style');
            styleElement.textContent = styleFile.args.fileContent;
            document.head.appendChild(styleElement);
            console.log(`Styles loaded successfully from: ${styleFile.args.filePath}`);
        });
        
        // Simple function to process and execute component code
        function executeComponent(code) {
            // Handle imports - replace them with appropriate variable declarations
            let processedCode = code;
            
            // Replace imports with variable declarations or remove them
            processedCode = processedCode.replace(/import\s+([\w]+)\s+from\s+['"][\.\w\/]+['"];?/g, '// Import removed: $1');
            processedCode = processedCode.replace(/import\s+\{([^}]*)\}\s+from\s+['"][\.\w\/]+['"];?/g, '// Import removed: {$1}');
            processedCode = processedCode.replace(/import\s+['"][\.\w\/]+['"];?/g, '// Import removed');
            
            // Handle export default by explicitly assigning to window
            processedCode = processedCode.replace(/export\s+default\s+([\w]+);?/g, 'window.$1 = $1;');
            
            // Handle arrow function exports
            processedCode = processedCode.replace(/export\s+default\s+(const|let|var)\s+([\w]+)\s+=\s+/g, '$1 $2 = window.$2 = ');
            
            // Handle function exports
            processedCode = processedCode.replace(/export\s+default\s+function\s+([\w]+)/g, 'function $1');
            
            // Add logging to help debug
            processedCode = processedCode + '\nconsole.log("Available components:", Object.keys(window).filter(k => typeof window[k] === "function" && k !== "eval"));';
            
            return processedCode;
        }

        // 2) Load and execute all component files (excluding index.jsx)
        const componentFiles = outputFiles.filter(file => 
            file.args.filePath.endsWith('.jsx') && 
            !file.args.filePath.includes('index.jsx')
        );
        
        componentFiles.forEach(componentFile => {
            console.log(`Loading component from: ${componentFile.args.filePath}`);
            try {
                const componentCode = componentFile.args.fileContent;
                
                // Process the component code
                const processedCode = executeComponent(componentCode);
                
                // Transform with Babel and execute
                const transformedCode = Babel.transform(processedCode, { presets: ['react'] }).code;
                console.log(`Transformed component code for ${componentFile.args.filePath}:`, transformedCode);
                
                // Evaluate the code
                window.eval(transformedCode);
                
                console.log(`Component loaded successfully from: ${componentFile.args.filePath}`);
            } catch (error) {
                console.error(`Failed to load component from ${componentFile.args.filePath}:`, error);
            }
        });
        
        // 3) Load and execute the main index file
        const indexFile = outputFiles.find(file => 
            file.args.filePath.endsWith('index.jsx')
        );
        
        if (indexFile) {
            console.log(`Loading main app from: ${indexFile.args.filePath}`);
            try {
                // Get the main app code
                const mainCode = indexFile.args.fileContent;
                
                // Process the code to handle exports and imports
                const processedCode = executeComponent(mainCode);
                
                // Transform with Babel
                const transformedCode = Babel.transform(processedCode, { presets: ['react'] }).code;
                console.log(`Transformed main app code:`, transformedCode);
                
                // Evaluate the code
                window.eval(transformedCode);
                
                console.log("Main app loaded successfully");
                console.log("Available in window:", Object.keys(window).filter(k => typeof window[k] === "function" && k !== "eval" && !k.startsWith("_")));
                
                // Mount the React app
                const root = ReactDOM.createRoot(document.getElementById('root'));
                
                // Look for the main component
                if (window.App) {
                    console.log("Rendering App component");
                    root.render(React.createElement(window.App));
                    console.log("App mounted successfully");
                } else if (window.HelloWorld) {
                    console.log("Rendering HelloWorld component");
                    root.render(React.createElement(window.HelloWorld));
                    console.log("HelloWorld mounted successfully");
                } else {
                    console.error("No App or HelloWorld component found in the global scope");
                }
            } catch (error) {
                console.error("Error loading main app:", error);
            }
        } else {
            console.error("No index.jsx file found");
        }
        
    } catch (error) {
        console.error("Error during execution:", error);
    }
</script>
</body>
</html>