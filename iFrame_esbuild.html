<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React App - Braintrust AppBuilder Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        #root {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #555;
            font-size: 16px;
        }
        .error {
            color: #d93f4c;
            padding: 20px;
            border: 1px solid #f5c6cb;
            border-radius: 4px;
            background-color: #f8d7da;
            margin-bottom: 20px;
        }
    </style>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18",
        "react-dom": "https://esm.sh/react-dom@18?external=react&standalone",
        "react-dom/client": "https://esm.sh/react-dom@18/client?external=react&standalone",
        "styled-components": "https://esm.sh/styled-components@6.x?external=react&standalone",
        "pdfjs-dist": "https://esm.sh/pdfjs-dist@4.10.38?standalone",
        "tesseract.js": "https://esm.sh/tesseract.js@6.0.0?standalone",
        "@zendeskgarden/react-theming": "https://esm.sh/@zendeskgarden/react-theming@9.x?external=react,styled-components&standalone",
        "@zendeskgarden/react-buttons": "https://esm.sh/@zendeskgarden/react-buttons@9.x?external=react,styled-components,@zendeskgarden/react-theming&standalone",
        "@zendeskgarden/react-grid": "https://esm.sh/@zendeskgarden/react-grid@9.x?external=react,styled-components,@zendeskgarden/react-theming&standalone",
        "@zendeskgarden/react-forms": "https://esm.sh/@zendeskgarden/react-forms@9.x?external=react,styled-components,@zendeskgarden/react-theming&standalone",
        "@zendeskgarden/react-tables": "https://esm.sh/@zendeskgarden/react-tables@9.x?external=react,styled-components,@zendeskgarden/react-theming&standalone",
        "@zendeskgarden/react-typography": "https://esm.sh/@zendeskgarden/react-typography@9.x?external=react,styled-components,@zendeskgarden/react-theming&standalone",
        "@zendeskgarden/react-loaders": "https://esm.sh/@zendeskgarden/react-loaders@9.x?external=react,styled-components,@zendeskgarden/react-theming&standalone",
        "@zendeskgarden/react-tags": "https://esm.sh/@zendeskgarden/react-tags@9.x?external=react,styled-components,@zendeskgarden/react-theming&standalone",
        "@zendeskgarden/react-tabs": "https://esm.sh/@zendeskgarden/react-tabs@9.x?external=react,styled-components,@zendeskgarden/react-theming&standalone",
        "@zendeskgarden/react-accordions": "https://esm.sh/@zendeskgarden/react-accordions@9.x?external=react,styled-components,@zendeskgarden/react-theming&standalone",
        "@zendeskgarden/react-tooltips": "https://esm.sh/@zendeskgarden/react-tooltips@9.x?external=react,styled-components,@zendeskgarden/react-theming&standalone",
        "@zendeskgarden/react-modals": "https://esm.sh/@zendeskgarden/react-modals@9.x?external=react,styled-components,@zendeskgarden/react-theming&standalone",
        "@zendeskgarden/react-notifications": "https://esm.sh/@zendeskgarden/react-notifications@9.x?external=react,styled-components,@zendeskgarden/react-theming&standalone",
        "@zendeskgarden/react-pagination": "https://esm.sh/@zendeskgarden/react-pagination@9.x?external=react,styled-components,@zendeskgarden/react-theming&standalone"
      }
    }
    </script>
</head>
<body>
    <div id="root">
        <div class="loading">Loading application...<div id="debug-info" style="color: #999; font-size: 12px; margin-top: 10px;"></div></div>
    </div>

    <!-- CDN Assets from CDN_ASSETS_MAPPING -->

    <script type="module">
      import React from 'react';
      import ReactDOM from 'react-dom/client';
      window.React = React;
      window.ReactDOM = ReactDOM;
    </script>
    
    <!-- esbuild-wasm for bundling -->
    <script src="https://unpkg.com/esbuild-wasm@0.17.19/lib/browser.min.js"></script>
    <script type="text/javascript" src="https://static.zdassets.com/zendesk_app_framework_sdk/2.0/zaf_sdk.min.js"></script>

    <!-- ZAFClient init will be set after the data is loaded -->

    <!-- Your React App -->
    <script>
    const data = {
  "type": "data",
  "data": {
    "_pagination_key": "p07535305238268870656",
    "_xact_id": "1000195571892760302",
    "created": "2025-08-06T03:12:46.914Z",
    "id": "7fedaa20-c041-4bdc-943e-28b3904ea1dc",
    "metadata": {},
    "metrics": {
      "end": 1754450069.843,
      "start": 1754449966.914,
      "prompt_tokens": 25922,
      "completion_tokens": 1749,
      "tokens": 27671,
      "estimated_cost": 0.104001
    },
    "origin": null,
    "root_span_id": "851a36c1-b43b-4f8f-8ad0-4133979e4cd2",
    "scores": null,
    "span_attributes": {
      "exec_counter": 0,
      "name": "eval",
      "type": "eval"
    },
    "span_id": "851a36c1-b43b-4f8f-8ad0-4133979e4cd2",
    "tags": [],
    "context": {},
    "expected": "The currentUser value is retrieved using zafClient.get('currentUser')",
    "experiment_id": "e6825aa8-a7f0-4501-8bea-e268e7d94436",
    "input": "Create an app that displays current agent information",
    "is_root": true,
    "output": [
      {
        "args": {
          "fileContent": "import React, { useState, useEffect } from 'react';\nimport { ThemeProvider } from '@zendeskgarden/react-theming';\nimport { Grid } from '@zendeskgarden/react-grid';\nimport { MD, LG, Paragraph } from '@zendeskgarden/react-typography';\nimport { AgentInfo } from './components/AgentInfo';\nimport { AppContainer, LoadingContainer, ErrorContainer } from './styles/AppStyles';\n\nconst App = () => {\n  const [agentData, setAgentData] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    const fetchAgentData = async () => {\n      try {\n        // Resize the app to appropriate height\n        await window.zafClient.invoke('resize', { height: '550px', width: '100%' });\n        \n        // Get current user (agent) information\n        const response = await window.zafClient.get('currentUser');\n        setAgentData(response.currentUser);\n        setLoading(false);\n      } catch (err) {\n        setError(JSON.stringify(err));\n        setLoading(false);\n      }\n    };\n\n    fetchAgentData();\n  }, []);\n\n  if (loading) {\n    return (\n      <ThemeProvider>\n        <LoadingContainer>\n          <MD>Loading agent information...</MD>\n        </LoadingContainer>\n      </ThemeProvider>\n    );\n  }\n\n  if (error) {\n    return (\n      <ThemeProvider>\n        <ErrorContainer>\n          <LG>Error Loading Agent Information</LG>\n          <Paragraph>{error}</Paragraph>\n        </ErrorContainer>\n      </ThemeProvider>\n    );\n  }\n\n  return (\n    <ThemeProvider>\n      <AppContainer>\n        <Grid>\n          <Grid.Row>\n            <Grid.Col>\n              <AgentInfo agent={agentData} />\n            </Grid.Col>\n          </Grid.Row>\n        </Grid>\n      </AppContainer>\n    </ThemeProvider>\n  );\n};\n\nexport default App;",
          "filePath": "index.jsx",
          "operation": "add"
        },
        "toolCallId": "toolu_bdrk_01GecPhV165SBq636UvxTquA",
        "toolName": "updateCode",
        "type": "tool-call"
      },
      {
        "args": {
          "fileContent": "import React from 'react';\nimport { Grid } from '@zendeskgarden/react-grid';\nimport { LG, MD, Paragraph } from '@zendeskgarden/react-typography';\nimport { \n  AgentCard, \n  AgentHeader, \n  AgentAvatar, \n  AgentDetails, \n  InfoRow, \n  InfoLabel, \n  InfoValue,\n  TagContainer,\n  Tag\n} from './styles/AgentInfoStyles';\n\nexport const AgentInfo = ({ agent }) => {\n  if (!agent) {\n    return (\n      <AgentCard>\n        <Paragraph>No agent information available</Paragraph>\n      </AgentCard>\n    );\n  }\n\n  const formatRole = (role) => {\n    return role.charAt(0).toUpperCase() + role.slice(1);\n  };\n\n  const formatTimeZone = (timeZone) => {\n    if (timeZone && timeZone.translatedName) {\n      return `${timeZone.translatedName} (${timeZone.formattedOffset})`;\n    }\n    return timeZone || 'Not specified';\n  };\n\n  return (\n    <AgentCard>\n      <AgentHeader>\n        <Grid>\n          <Grid.Row alignItems=\"center\">\n            <Grid.Col xs={3}>\n              {agent.avatarUrl && (\n                <AgentAvatar src={agent.avatarUrl} alt={`${agent.name}'s avatar`} />\n              )}\n            </Grid.Col>\n            <Grid.Col xs={9}>\n              <LG>{agent.name}</LG>\n              <MD>{formatRole(agent.role)}</MD>\n            </Grid.Col>\n          </Grid.Row>\n        </Grid>\n      </AgentHeader>\n\n      <AgentDetails>\n        <InfoRow>\n          <InfoLabel>\n            <MD>Email:</MD>\n          </InfoLabel>\n          <InfoValue>\n            <Paragraph>{agent.email}</Paragraph>\n          </InfoValue>\n        </InfoRow>\n\n        <InfoRow>\n          <InfoLabel>\n            <MD>Agent ID:</MD>\n          </InfoLabel>\n          <InfoValue>\n            <Paragraph>{agent.id}</Paragraph>\n          </InfoValue>\n        </InfoRow>\n\n        {agent.alias && (\n          <InfoRow>\n            <InfoLabel>\n              <MD>Alias:</MD>\n            </InfoLabel>\n            <InfoValue>\n              <Paragraph>{agent.alias}</Paragraph>\n            </InfoValue>\n          </InfoRow>\n        )}\n\n        <InfoRow>\n          <InfoLabel>\n            <MD>Locale:</MD>\n          </InfoLabel>\n          <InfoValue>\n            <Paragraph>{agent.locale}</Paragraph>\n          </InfoValue>\n        </InfoRow>\n\n        <InfoRow>\n          <InfoLabel>\n            <MD>Time Zone:</MD>\n          </InfoLabel>\n          <InfoValue>\n            <Paragraph>{formatTimeZone(agent.timeZone)}</Paragraph>\n          </InfoValue>\n        </InfoRow>\n\n        {agent.externalId && (\n          <InfoRow>\n            <InfoLabel>\n              <MD>External ID:</MD>\n            </InfoLabel>\n            <InfoValue>\n              <Paragraph>{agent.externalId}</Paragraph>\n            </InfoValue>\n          </InfoRow>\n        )}\n\n        {agent.groups && agent.groups.length > 0 && (\n          <InfoRow>\n            <InfoLabel>\n              <MD>Groups:</MD>\n            </InfoLabel>\n            <InfoValue>\n              <TagContainer>\n                {agent.groups.map((group) => (\n                  <Tag key={group.id}>\n                    <Paragraph>{group.name}</Paragraph>\n                  </Tag>\n                ))}\n              </TagContainer>\n            </InfoValue>\n          </InfoRow>\n        )}\n\n        {agent.tags && agent.tags.length > 0 && (\n          <InfoRow>\n            <InfoLabel>\n              <MD>Tags:</MD>\n            </InfoLabel>\n            <InfoValue>\n              <TagContainer>\n                {agent.tags.map((tag, index) => (\n                  <Tag key={index}>\n                    <Paragraph>{tag}</Paragraph>\n                  </Tag>\n                ))}\n              </TagContainer>\n            </InfoValue>\n          </InfoRow>\n        )}\n\n        {agent.details && (\n          <InfoRow>\n            <InfoLabel>\n              <MD>Details:</MD>\n            </InfoLabel>\n            <InfoValue>\n              <Paragraph>{agent.details}</Paragraph>\n            </InfoValue>\n          </InfoRow>\n        )}\n\n        {agent.notes && (\n          <InfoRow>\n            <InfoLabel>\n              <MD>Notes:</MD>\n            </InfoLabel>\n            <InfoValue>\n              <Paragraph>{agent.notes}</Paragraph>\n            </InfoValue>\n          </InfoRow>\n        )}\n      </AgentDetails>\n    </AgentCard>\n  );\n};",
          "filePath": "components/AgentInfo.jsx",
          "operation": "add"
        },
        "toolCallId": "toolu_bdrk_012tzK9ZH5e6xZiCBs969URf",
        "toolName": "updateCode",
        "type": "tool-call"
      },
      {
        "args": {
          "fileContent": "import styled from 'styled-components';\n\nexport const AppContainer = styled.div`\n  padding: 16px;\n  min-height: 550px;\n`;\n\nexport const LoadingContainer = styled.div`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 200px;\n  padding: 16px;\n`;\n\nexport const ErrorContainer = styled.div`\n  padding: 16px;\n  text-align: center;\n  color: #d93f4c;\n`;",
          "filePath": "styles/AppStyles.js",
          "operation": "add"
        },
        "toolCallId": "toolu_bdrk_01CxAZrMsL26nvWfXPv6Qtu5",
        "toolName": "updateCode",
        "type": "tool-call"
      },
      {
        "args": {
          "fileContent": "import styled from 'styled-components';\n\nexport const AgentCard = styled.div`\n  background: #ffffff;\n  border: 1px solid #d8dcde;\n  border-radius: 4px;\n  padding: 0;\n  margin-bottom: 16px;\n`;\n\nexport const AgentHeader = styled.div`\n  padding: 16px;\n  border-bottom: 1px solid #d8dcde;\n  background: #f8f9fa;\n`;\n\nexport const AgentAvatar = styled.img`\n  width: 48px;\n  height: 48px;\n  border-radius: 50%;\n  object-fit: cover;\n`;\n\nexport const AgentDetails = styled.div`\n  padding: 16px;\n`;\n\nexport const InfoRow = styled.div`\n  display: flex;\n  margin-bottom: 12px;\n  align-items: flex-start;\n  \n  &:last-child {\n    margin-bottom: 0;\n  }\n`;\n\nexport const InfoLabel = styled.div`\n  min-width: 100px;\n  font-weight: 600;\n  color: #68737d;\n  margin-right: 12px;\n  flex-shrink: 0;\n`;\n\nexport const InfoValue = styled.div`\n  flex: 1;\n  word-break: break-word;\n`;\n\nexport const TagContainer = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n  gap: 4px;\n`;\n\nexport const Tag = styled.div`\n  background: #edf7ff;\n  border: 1px solid #1f73b7;\n  border-radius: 12px;\n  padding: 2px 8px;\n  font-size: 12px;\n  color: #1f73b7;\n`;",
          "filePath": "styles/AgentInfoStyles.js",
          "operation": "add"
        },
        "toolCallId": "toolu_bdrk_01XJP2W7nc5v68ZcLwD4JrBM",
        "toolName": "updateCode",
        "type": "tool-call"
      },
      {
        "args": {
          "fileContent": "window.zafClient = {\n  get: function(path) {\n    return new Promise(function(resolve) {\n      if (path === 'currentUser') {\n        resolve({\n          currentUser: {\n            id: 12345,\n            name: 'John Smith',\n            email: 'john.smith@company.com',\n            role: 'agent',\n            locale: 'en-US',\n            alias: 'J. Smith',\n            externalId: 'EXT-12345',\n            avatarUrl: 'https://via.placeholder.com/48x48/1f73b7/ffffff?text=JS',\n            timeZone: {\n              name: 'America/New_York',\n              translatedName: 'Eastern Time',\n              ianaName: 'America/New_York',\n              offset: -18000,\n              formattedOffset: 'GMT-05:00'\n            },\n            groups: [\n              { id: 1, name: 'Support Team' },\n              { id: 2, name: 'Tier 1 Agents' }\n            ],\n            tags: ['experienced', 'technical', 'customer-focused'],\n            details: 'Senior support agent with 3+ years experience',\n            notes: 'Specializes in technical issues and escalations'\n          }\n        });\n      }\n      resolve({});\n    });\n  },\n  \n  set: function(path, value) {\n    return new Promise(function(resolve) {\n      resolve('success');\n    });\n  },\n  \n  request: function(options) {\n    return new Promise(function(resolve) {\n      resolve({});\n    });\n  },\n  \n  invoke: function(action, data) {\n    return new Promise(function(resolve) {\n      if (action === 'resize') {\n        console.log('App resized to:', data);\n      }\n      resolve('success');\n    });\n  }\n};",
          "filePath": "mock.js",
          "operation": "add"
        },
        "toolCallId": "toolu_bdrk_01LoPsZ7AV18bpHWQfuTtLvc",
        "toolName": "updateCode",
        "type": "tool-call"
      },
      {
        "args": {
          "appTitle": "Agent Information Display",
          "fileContent": "# Agent Information Display App\n\n## App Description\nThis Zendesk app displays comprehensive information about the currently logged-in agent. It provides a clean, organized view of agent details including personal information, role, contact details, group memberships, tags, and other relevant data. The app is designed to help agents quickly access their own profile information within the Zendesk interface.\n\n## Architecture\nThe app follows a component-based React architecture with clear separation of concerns:\n- **Main App Component**: Handles data fetching and state management\n- **AgentInfo Component**: Renders the agent information in a structured format\n- **Styled Components**: Provides consistent styling and theming\n- **ZAF Integration**: Uses Zendesk App Framework APIs for data retrieval\n\n## List of Features\n- **Agent Profile Display**: Shows agent name, avatar, and role\n- **Contact Information**: Displays email address and agent ID\n- **Personal Details**: Shows alias, locale, and time zone information\n- **Group Memberships**: Lists all groups the agent belongs to\n- **Tag Display**: Shows agent tags in a visually appealing format\n- **Additional Information**: Displays external ID, details, and notes when available\n- **Responsive Design**: Adapts to different screen sizes within the Zendesk sidebar\n- **Error Handling**: Provides clear error messages if data loading fails\n- **Loading States**: Shows loading indicator while fetching data\n\n## Documentation Used\n- **coreAppsAPI**: For app lifecycle management and resize functionality\n- **allLocations**: For accessing current user information via ZAF APIs\n- **react-theming**: For Zendesk Garden theme integration\n- **react-grid**: For responsive layout and positioning\n- **react-typography**: For consistent text styling and formatting\n\n## Tech Stack\n- **React 18**: Frontend framework for component-based UI\n- **Zendesk Garden Components v9**: UI component library for consistent Zendesk styling\n- **Styled Components**: CSS-in-JS styling solution\n- **Zendesk App Framework (ZAF)**: For accessing Zendesk APIs and agent data\n- **JavaScript ES6+**: Modern JavaScript features for clean, maintainable code\n\n## File Structure\n- **index.jsx**: Main entry point and app component with data fetching logic\n- **components/AgentInfo.jsx**: Component for rendering agent information\n- **styles/AppStyles.js**: Styled components for main app layout\n- **styles/AgentInfoStyles.js**: Styled components for agent information display\n- **mock.js**: Mock ZAF client implementation for development and testing\n- **blueprint.md**: This documentation file\n- **changelog.md**: Version history and change tracking\n\n## Integration Details\nThe app integrates with Zendesk through the ZAF (Zendesk App Framework) APIs:\n- Uses `client.get('currentUser')` to retrieve current agent information\n- Implements proper error handling for API failures\n- Automatically resizes the app iframe to appropriate dimensions\n- Follows Zendesk's design guidelines and accessibility standards\n\nThe app is designed to run in the Zendesk ticket sidebar and provides agents with quick access to their profile information without leaving their current workflow.",
          "filePath": "blueprint.md",
          "operation": "add"
        },
        "toolCallId": "toolu_bdrk_01MzdVdsPuyVE2MwVhBtGb2w",
        "toolName": "updateCode",
        "type": "tool-call"
      },
      {
        "args": {
          "fileContent": "# Changelog\n\n## Version 1\n- Add agent information display with comprehensive profile data\n- Add responsive grid layout for optimal sidebar viewing\n- Add agent avatar display with fallback handling\n- Add role formatting and display\n- Add time zone information with formatted offset\n- Add group membership display with tag styling\n- Add agent tags display in organized container\n- Add personal details section with alias and locale\n- Add additional information fields for external ID, details, and notes\n- Add loading state with centered indicator\n- Add error handling with detailed error messages\n- Add automatic app resizing for proper sidebar fit\n- Add styled components for consistent Zendesk theming",
          "filePath": "changelog.md",
          "operation": "add"
        },
        "toolCallId": "toolu_bdrk_01SPFbHpcvPxjuV9JnYC2zP3",
        "toolName": "updateCode",
        "type": "tool-call"
      }
    ],
    "project_id": "2fd21702-cca3-44a3-ac91-bf55e7d0e658"
  }
};
    // Main function to initialize esbuild and bundle the app
    async function initializeAndBundleApp() {
        try {
            // Get files from the data structure
            const outputFiles = data.data.output;
            console.log("Processing files:", outputFiles.map(f => f.args.filePath));
            
            // Initialize ZAF Client and mock data
            try {
                // Initialize ZAFClient
                window.zafClient = ZAFClient.init();
                
                // Find and use the mock.js file
                const mockFile = outputFiles.find(file => 
                    file.args.filePath === 'mock.js' || 
                    file.args.filePath.endsWith('/mock.js'));
                if (mockFile) {
                    console.log("Found mock.js file");
                    const mockContent = mockFile.args.fileContent;
                    // Create a new script element to evaluate the mock file
                    const mockScript = document.createElement('script');
                    mockScript.textContent = mockContent;
                    document.head.appendChild(mockScript);
                    console.log("Mock data loaded successfully");
                } else {
                    console.warn("Could not find mock.js file in outputFiles");
                }
            } catch (error) {
                console.error("Error initializing ZAF client:", error);
            }

            // Initialize esbuild-wasm
            console.log("Initializing esbuild...");
            await esbuild.initialize({
                wasmURL: 'https://unpkg.com/esbuild-wasm@0.17.19/esbuild.wasm',
                worker: true
            });
            console.log("esbuild initialized successfully");

            // 1) First, load and apply all CSS/styles files
            const styleFiles = outputFiles.filter(file => 
                file.args.filePath.includes('styles') || 
                file.args.filePath.endsWith('.css') || 
                file.args.filePath.includes('styles.js')
            );
            
            console.log('Style files found:', styleFiles.map(f => f.args.filePath));
            console.log('Style file content sample:', styleFiles[0]?.args.fileContent?.substring(0, 100));
            
            styleFiles.forEach(styleFile => {
                console.log(`Loading styles from: ${styleFile.args.filePath}`);
                const styleElement = document.createElement('style');
                styleElement.textContent = styleFile.args.fileContent;
                document.head.appendChild(styleElement);
                console.log(`Styles loaded successfully from: ${styleFile.args.filePath}`);
            });
            
            // 2) Create a virtual file system from all the JS/JSX files (not CSS)
            const jsxFiles = outputFiles.filter(file => 
                file.args.filePath.endsWith('.jsx') || 
                (file.args.filePath.endsWith('.js') && !file.args.filePath.includes('styles.js'))
            );
            
            console.log('JSX files found:', jsxFiles.map(f => f.args.filePath));
            jsxFiles.forEach(file => {
                console.log(`${file.args.filePath} content preview:`, file.args.fileContent.substring(0, 100));
            });
            
            // Create a map of files for our virtual file system
            const virtualFileSystem = {};
            jsxFiles.forEach(file => {
                // Modify the SomeComponent export to not use window
                if (file.args.filePath.includes('someComponent.jsx')) {
                    const content = file.args.fileContent.replace(
                        "// Export for use in other files\nwindow.SomeComponent = SomeComponent;", 
                        "export default SomeComponent;"
                    );
                    virtualFileSystem[file.args.filePath] = content;
                } else {
                    virtualFileSystem[file.args.filePath] = file.args.fileContent;
                }
            });
            
            console.log("Virtual file system created with files:", Object.keys(virtualFileSystem));
            
            // Find the entry point (index.jsx)
            const entryPoint = jsxFiles.find(file => file.args.filePath.endsWith('index.jsx'))?.args.filePath;
            
            if (!entryPoint) {
                throw new Error("No index.jsx entry point found");
            }
            
            console.log(`Using entry point: ${entryPoint}`);
            
            // Create a plugin to resolve imports from our virtual file system
            const virtualFsPlugin = {
                name: 'virtual-fs',
                setup(build) {
                    // Handle all file resolution
                    build.onResolve({ filter: /.*/ }, args => {
                        if (args.kind === 'entry-point') {
                            return { path: args.path, namespace: 'virtual-fs' };
                        }
                        
                        // Handle relative imports
                        if (args.path.startsWith('./') || args.path.startsWith('../')) {
                            let normalizedPath = args.path;
                            let resolveDir = args.resolveDir || '';
                            
                            // Remove ./ from the beginning
                            if (normalizedPath.startsWith('./')) {
                                normalizedPath = normalizedPath.substring(2);
                            }
                            
                            // Construct the full path
                            const basePath = resolveDir ? `${resolveDir}/` : '';
                            const fullPath = `${basePath}${normalizedPath}`;
                            
                            // Check if the file exists in our virtual file system
                            const possiblePaths = [
                                fullPath,
                                `${fullPath}.jsx`,
                                `${fullPath}.js`,
                                // Handle CSS imports
                                normalizedPath,
                                `${normalizedPath}.js`
                            ];
                            
                            for (const path of possiblePaths) {
                                if (virtualFileSystem[path]) {
                                    return { path, namespace: 'virtual-fs' };
                                }
                            }
                            
                            console.warn(`Could not resolve: ${args.path} from ${resolveDir}`);
                        }
                        
                        // Pass through external dependencies (like React)
                        return { path: args.path, external: true };
                    });
                    
                    // Load files from virtual file system
                    build.onLoad({ filter: /.*/, namespace: 'virtual-fs' }, args => {
                        const fileContent = virtualFileSystem[args.path];
                        
                        if (fileContent) {
                            // Determine loader based on file extension
                            const loader = args.path.endsWith('.css') ? 'css' : 'jsx';
                            const resolveDir = args.path.split('/').slice(0, -1).join('/');
                            
                            return { 
                                contents: fileContent, 
                                loader, 
                                resolveDir 
                            };
                        }
                        
                        return null;
                    });
                }
            };
            
            // Bundle the application
            console.log("Starting bundle process...");
            
            // Handle CSS imports to prevent esbuild errors
            try {
                if (virtualFileSystem[entryPoint]) {
                    console.log("Processing entry point for CSS imports");
                    const indexContent = virtualFileSystem[entryPoint];
                    
                    // Replace any CSS/style imports with comments
                    const modifiedContent = indexContent
                        .replace(/import\s+['"]\.\/(styles|css)\/.*?['"];?\s*/g, '// CSS styles are loaded separately\n')
                        .replace(/import\s+['"]\.\.\/styles\/.*?['"];?\s*/g, '// CSS styles are loaded separately\n');
                    
                    // Log what changed
                    if (modifiedContent !== indexContent) {
                        console.log("Removed CSS imports from entry point");
                    } else {
                        console.log("No CSS imports found in entry point");
                    }
                    
                    virtualFileSystem[entryPoint] = modifiedContent;
                }
            } catch (err) {
                console.warn("Error processing CSS imports:", err);
                // Continue anyway - CSS is loaded separately
            }

            let result;
            try {
                console.log('Running initial build with format: esm');
                result = await esbuild.build({
                    entryPoints: [entryPoint],
                    bundle: true,
                    format: 'esm',  // ES modules format to work with import map
                    jsx: 'transform',
                    jsxFactory: 'React.createElement',
                    jsxFragment: 'React.Fragment',
                    plugins: [virtualFsPlugin],
                    define: {
                        'process.env.NODE_ENV': '"development"'
                    },
                    external: ['*.css', '*.scss', 'react', 'react-dom', 'react-dom/client', 'styled-components', '@zendeskgarden/*'],  // Use CDN imports
                    write: false, // Output to memory
                    logLevel: 'info'
                });
            } catch (buildError) {
                console.error("esbuild build failed:", buildError);
                
                // Try a simpler approach as fallback
                console.log("Attempting fallback build without CSS imports...");
                
                // Additional cleanup of problematic imports in all files
                Object.keys(virtualFileSystem).forEach(key => {
                    virtualFileSystem[key] = virtualFileSystem[key].replace(
                        /import\s+['"].*?\.(css|scss|less|styles)['"];?\s*/g,
                        '// CSS import removed\n'
                    );
                });
                
                // Try again with the cleaned files
                console.log('Running initial build with format: esm');
                result = await esbuild.build({
                    entryPoints: [entryPoint],
                    bundle: true,
                    format: 'esm',  // ES modules format to work with import map
                    jsx: 'transform',
                    jsxFactory: 'React.createElement',
                    jsxFragment: 'React.Fragment',
                    plugins: [virtualFsPlugin],
                    define: {
                        'process.env.NODE_ENV': '"development"'
                    },
                    external: ['*.css', '*.scss', '*.styles.js', 'react', 'react-dom', 'react-dom/client', 'styled-components', '@zendeskgarden/*'],
                    write: false
                });
            }
            
            console.log("Bundle completed successfully");
            
            if (result.errors.length > 0) {
                console.error("Build errors:", result.errors);
                throw new Error(`Build failed with ${result.errors.length} errors`);
            }
            
            if (result.warnings.length > 0) {
                console.warn("Build warnings:", result.warnings);
            }
            
            // Execute the bundled code
            const bundledCode = result.outputFiles[0].text;
            console.log("Bundled code size:", bundledCode.length, "bytes");
            
            // Add error handlers to debug React rendering issues
            window.addEventListener('error', function(event) {
                console.error('Global error caught:', event.error);
                const debugInfo = document.getElementById('debug-info');
                if (debugInfo) {
                    debugInfo.textContent = 'Error: ' + (event.error?.message || event.message || 'Unknown error');
                }
            });
            
            window.addEventListener('unhandledrejection', function(event) {
                console.error('Unhandled promise rejection:', event.reason);
                const debugInfo = document.getElementById('debug-info');
                if (debugInfo) {
                    debugInfo.textContent = 'Promise error: ' + (event.reason?.message || 'Unknown promise error');
                }
            });
            
            // Execute the bundled code
            try {
                // Create a blob URL for the bundled code
                const bundleBlob = new Blob([bundledCode], { type: 'text/javascript' });
                const bundleUrl = URL.createObjectURL(bundleBlob);
                
                console.log("Bundle URL created:", bundleUrl);
                
                // Create and execute module script to import the app
                try {
                    const moduleScript = document.createElement('script');
                    moduleScript.type = 'module';
                    // Reset the root element to make sure we see the loading state
                    document.getElementById('root').innerHTML = '<div class="loading">Loading application... <div id="debug-info" style="color: #999; font-size: 12px; margin-top: 10px;">Starting to load components...</div></div>';
                    
                    moduleScript.textContent = `
                        // Debug imports
                        console.log('Import map available:', Object.keys(Array.from(document.querySelectorAll('script[type="importmap"]')).map(s => JSON.parse(s.textContent).imports || {}).reduce((acc, imports) => ({ ...acc, ...imports }), {})));
                        
                        // Wait for Garden components to download before loading the app
                        document.getElementById('debug-info').textContent = 'Waiting for Zendesk Garden components to load (5 seconds)...';
                        
                        // Pre-fetch Zendesk Garden Button to ensure it's downloaded
                        console.log('Pre-fetching Garden Button component...');
                        import('@zendeskgarden/react-buttons')
                            .then(gardenButtons => {
                                console.log('Successfully pre-fetched Zendesk Garden components:', gardenButtons);
                            })
                            .catch(err => {
                                console.error('Error pre-fetching Garden components:', err);
                            });
                        
                        // Delay app loading to ensure Garden components are downloaded
                        setTimeout(() => {
                            document.getElementById('debug-info').textContent = 'Loading app after Garden components delay...';
                            
                            import('${bundleUrl}')
                                .then(module => {
                                    document.getElementById('debug-info').textContent = 'Module loaded, looking for App component...';
                                    console.log('Module loaded:', module);
                                    
                                    const App = module.default || module;
                                    console.log('App component:', App);
                                    
                                    if (typeof App !== 'function') {
                                        document.getElementById('debug-info').textContent = 'Error: App is not a component function';
                                        console.error('App is not a component function:', App);
                                        return;
                                    }
                                    
                                    document.getElementById('debug-info').textContent = 'Found App, attempting to render...';
                                    const root = ReactDOM.createRoot(document.getElementById('root'));
                                    
                                    try {
                                        console.log('About to render App');
                                        root.render(React.createElement(App));
                                        console.log('Render completed');
                                        document.getElementById('debug-info').textContent = 'App rendered successfully';
                                        // Force full reload of styles
                                        document.getElementById('root').style.opacity = '0';
                                        setTimeout(() => {
                                            document.getElementById('root').style.opacity = '1';
                                        }, 100);
                                    } catch(e) {
                                        document.getElementById('debug-info').textContent = 'Error rendering: ' + e.message;
                                        console.error('Render error:', e);
                                    }
                                })
                                .catch(error => {
                                    document.getElementById('debug-info').textContent = 'Import error: ' + error.message;
                                    console.error('Import error:', error);
                                });
                        }, 5000); // 5 second delay
                    `;
                    
                    // Add the module script to the document
                    document.body.appendChild(moduleScript);
                    console.log("Module script created and executed");
                } catch (moduleError) {
                    console.error("Error creating module script:", moduleError);
                    
                    // Fallback to legacy approach
                    console.log("Falling back to direct component rendering");
                    
                    const root = ReactDOM.createRoot(document.getElementById('root'));
                    
                    if (window.App) {
                        console.log("Rendering App component");
                        root.render(React.createElement(window.App));
                    } else {
                        // Look for any React component in the global namespace
                        const components = Object.keys(window).filter(key => {
                            return typeof window[key] === 'function' &&
                                   key !== 'React' &&
                                   key !== 'ReactDOM' &&
                                   !key.startsWith('_');
                        });
                        
                        if (components.length > 0) {
                            const componentName = components[0];
                            console.log(`Found component ${componentName}. Rendering...`);
                            root.render(React.createElement(window[componentName]));
                        } else {
                            throw new Error("No React component found to render");
                        }
                    }
                    
                    console.log("App mounted successfully");
                }
            } catch (error) {
                console.error("Error executing bundle:", error);
                throw error;
            }
            
        } catch (error) {
            console.error("Error during bundling or rendering:", error);
            document.getElementById('root').innerHTML = `
                <div class="error">
                    <h3>Error in Application</h3>
                    <p>${error.message}</p>
                    <pre style="background: #f8f9fa; padding: 10px; overflow: auto; max-height: 300px;">${error.stack}</pre>
                </div>
            `;
        }
    }
    
    // Start the bundling process
    initializeAndBundleApp();
    </script>
</body>
</html>